<body>
  <div class="slider-container">
    <input type="range" min="-1" max="1" value="0" step="0.001" class="slider" id="slider">
  </div>
  <p id="display">
    
  </p>
</body>
<style>
  input {
    width: 100%;
  }
</style>
<script>
  
  const slider = document.getElementById("slider");
  const display = document.getElementById("display");

  let i = 0;
  let startTime;

  async function start () {
      const audioContext = new AudioContext();
      startTime = audioContext.currentTime + 0.01;
      console.log("before");
      await audioContext.audioWorklet.addModule("white-noise-processor.js");
      console.log("after");
      const whiteNoiseNode = new AudioWorkletNode(
        audioContext,
        "white-noise-processor",
      );
      whiteNoiseNode.connect(audioContext.destination);
      slider.addEventListener("input", () => {
        display.innerText = slider.value;
        const gainParam = whiteNoiseNode.parameters.get("customGain");
        // gainParam.setValueAtTime(slider.value + 1, audioContext.currentTime);
        gainParam.linearRampToValueAtTime(slider.value + 1, audioContext.currentTime + 1);
      })
      document.addEventListener("keydown", (e) => {
        if (e.key === "p") {
          function wave() {
            const gainParam = whiteNoiseNode.parameters.get("customGain");
            gainParam.setValueAtTime(Math.sin(i * 0.0576) + 1, audioContext.currentTime);
            i++;
            setTimeout(wave, 1);
          }
          wave();
        }
      })
      function moveSlider() {
        const index = ((audioContext.currentTime - startTime) * audioContext.sampleRate).toFixed(0);
        console.log(index);
        slider.value = index;
        moveSlider();
      }
      // setTimeout(moveSlider, 1000);
  }

  // function change (whiteNoiseNode, audioContext) {
  //   console.log("ran");
  //   const gainParam = whiteNoiseNode.parameters.get("customGain");
  //   console.log(gainParam);
  //   gainParam.setValueAtTime(0, audioContext.currentTime);
  //   gainParam.linearRampToValueAtTime(0.5, audioContext.currentTime + 0.5);
  // }

  document.addEventListener("click", start);


</script>
