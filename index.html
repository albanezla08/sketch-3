<body>
  <div class="slider-container">
    <input type="range" min="-1" max="1" value="0" step="0.1" class="slider" id="slider">
  </div>
  <p id="display">
    
  </p>
</body>
<script>
  
const dur = 3 // duration in seconds
const ctx = new window.AudioContext()
const data = ctx.createBuffer(2, ctx.sampleRate, ctx.sampleRate)
const leftChannel = data.getChannelData(0)
  
let prev = -1;
let delta = 0.01;
for (let i = 0; i < data.length; i++) {
  // leftChannel[i] = Math.sin(i * 0.0576)
  // leftChannel[i] = 0.5
  // if (i % 2 === 0) {
  //   leftChannel[i] = 1;
  // } else {
  //   leftChannel[i] = 0;
  // }
  leftChannel[i] = prev;
  prev += delta;
  if (prev > 1 || prev < -1) {
    delta *= -1;
    // prev = -1;
  }
}
  
// function change () {
//   leftChannel[0] = prev;
//   prev += delta;
//   if (prev > 1 || prev < -1) {
//     delta *= -1;
//     // prev = -1;
//   }
//   requestAnimationFrame(change);
//   // console.log(leftChannel);
// }
  
// console.log(leftChannel)

// for (let i = 0; i < data.length; i++) {
//   const percentage = i / data.length;
//   // console.log(percentage);
//   // if (percentage < 0.333) {
//   //   leftChannel[i] = -1;
//   // } else if (percentage < 0.67) {
//   //   leftChannel[i] = 0;
//   // } else{
//   //   leftChannel[i] = 1;
//   // }
//   const intensity = 2 * percentage - 1;
//   leftChannel[i] = intensity;
// }

const sound = ctx.createBufferSource()
sound.loop = true
sound.buffer = data
sound.connect(ctx.destination)
// sound.start(0)
// sound.stop(0.5)
  
// sound.start();
  
function change () {
  for (let i = 0; i < data.length; i++) {
    // leftChannel[i] = Math.sin(i * 0.0576)
    // leftChannel[i] = 0.5
    // if (i % 2 === 0) {
    //   leftChannel[i] = 1;
    // } else {
    //   leftChannel[i] = 0;
    // }
    leftChannel[i] = 0;
  }
  console.log(leftChannel);
  // sound.start();
}
  
// setTimeout(change, 5000);
  
  
function increment() {
  leftChannel[0] = prev;
  prev += delta;
  if (prev > 1 || prev < -1) {
    delta *= -1;
    // prev = -1;
  }
  // console.log(leftChannel);
  setTimeout(increment, sound.duration);
}
  

const slider = document.getElementById("slider");
const display = document.getElementById("display");
slider.addEventListener("input", () => {
  display.innerText = slider.value;
  // leftChannel[0] = slider.value;
  for (let i = 0; i < data.length; i++) {
    leftChannel[i] = slider.value;
  }
})
  
// increment();
  
// change();
  
// let time = 0;
  
// function recurse () {
//   sound.start(ctx.currentTime);
//   // time += sound.duration;
//   requestAnimationFrame(recurse);
// }

  async function start () {
    const audioContext = new AudioContext();
    await audioContext.audioWorklet.addModule("white-noise-processor.js");
    const whiteNoiseNode = new AudioWorkletNode(
      audioContext,
      "white-noise-processor",
    );
    whiteNoiseNode.connect(audioContext.destination);
}

document.addEventListener("click", start);
  
// recurse();

</script>
